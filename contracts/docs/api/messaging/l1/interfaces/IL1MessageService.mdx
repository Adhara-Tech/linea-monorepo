# `IL1MessageService`

### addL2MerkleRoots

```solidity
function addL2MerkleRoots(bytes32[] newRoots, uint256 treeDepth) external
```

Add the L2 Merkle roots to the storage. This function is called during block finalization.
The indexed tree depth does not need to be checked to be non-zero as it is, already enforced to be non-zero in the circuit, and used in the proof's public input.

#### Parameters

| Name | Type | Description |
| ---- | ---- | ----------- |
| newRoots | bytes32[] | New L2 Merkle roots. |
| treeDepth | uint256 | The indexed tree depth of the Merkle root. |

### anchorL2MessagingBlocks

```solidity
function anchorL2MessagingBlocks(bytes l2MessagingBlocksOffsets, uint256 currentL2BlockNumber) external
```

Emit an event for each L2 block containing L2->L1 messages. This function is called during block finalization.

#### Parameters

| Name | Type | Description |
| ---- | ---- | ----------- |
| l2MessagingBlocksOffsets | bytes | Is a sequence of uint16 values, where each value plus the last finalized L2 block number indicates which L2 blocks have L2->L1 messages. |
| currentL2BlockNumber | uint256 | Last L2 block number finalized on L1. |

### validateL2ComputedRollingHash

```solidity
function validateL2ComputedRollingHash(uint256 rollingHashMessageNumber, bytes32 rollingHash) external view
```

Internal function to validate L1 rolling hash.

#### Parameters

| Name | Type | Description |
| ---- | ---- | ----------- |
| rollingHashMessageNumber | uint256 | Message number associated with the rolling hash as computed on L2. |
| rollingHash | bytes32 | L1 rolling hash as computed on L2. |

### ClaimMessageWithProofParams

#### Parameters

| Name | Type | Description |
| ---- | ---- | ----------- |

```solidity
struct ClaimMessageWithProofParams {
  bytes32[] proof;
  uint256 messageNumber;
  uint32 leafIndex;
  address from;
  address to;
  uint256 fee;
  uint256 value;
  address payable feeRecipient;
  bytes32 merkleRoot;
  bytes data;
}
```

### L2MerkleRootDoesNotExist

```solidity
error L2MerkleRootDoesNotExist()
```

_Thrown when L2 Merkle root does not exist._

### InvalidMerkleProof

```solidity
error InvalidMerkleProof()
```

_Thrown when the Merkle proof is invalid._

### ProofLengthDifferentThanMerkleDepth

```solidity
error ProofLengthDifferentThanMerkleDepth(uint256 actual, uint256 expected)
```

_Thrown when Merkle depth doesn't match proof length._

### claimMessageWithProof

```solidity
function claimMessageWithProof(struct IL1MessageService.ClaimMessageWithProofParams _params) external
```

Claims and delivers a cross-chain message using a Merkle proof.

_if tree depth is empty, it will revert with L2MerkleRootDoesNotExist.
if tree depth is different than proof size, it will revert with ProofLengthDifferentThanMerkleDepth._

#### Parameters

| Name | Type | Description |
| ---- | ---- | ----------- |
| _params | struct IL1MessageService.ClaimMessageWithProofParams | Collection of claim data with proof and supporting data. |

